var I=Object.defineProperty,T=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var F=(e,n,t)=>n in e?I(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,g=(e,n)=>{for(var t in n||(n={}))E.call(n,t)&&F(e,t,n[t]);if(v)for(var t of v(n))S.call(n,t)&&F(e,t,n[t]);return e},y=(e,n)=>T(e,O(n));var P=(e,n)=>{var t={};for(var o in e)E.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(e!=null&&v)for(var o of v(e))n.indexOf(o)<0&&S.call(e,o)&&(t[o]=e[o]);return t};import{u as k,r as b,j as s,l as A,S as _,E as q,a as w,R as $,b as D,Q as j,c as H,d as W}from"./vendor.80e9a551.js";const V=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}};V();const G="modulepreload",C={},Q="/",K=function(n,t){return!t||t.length===0?n():Promise.all(t.map(o=>{if(o=`${Q}${o}`,o in C)return;C[o]=!0;const r=o.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":G,r||(l.as="script",l.crossOrigin=""),l.href=o,document.head.appendChild(l),r)return new Promise((d,f)=>{l.addEventListener("load",d),l.addEventListener("error",f)})})).then(()=>n())};async function z(e){const{repo:n,owner:t,path:o,fileRef:r}=e;let a=r||"HEAD";const l=`https://api.github.com/repos/${t}/${n}/git/trees/${a}?recursive=1`,d=await fetch(l,{headers:{Accept:`Bearer ${J}`}}),{tree:f}=await d.json(),i=f.filter(u=>{var h;return(h=u.path)==null?void 0:h.includes(o)}).map(u=>({path:u.path||"",mode:u.mode||"",type:u.type||"",sha:u.sha||"",size:u.size||0,url:u.url||""})),m={download_url:l,folder:o.split("/").pop()||"",path:o,repo:n,owner:t,sha:a,username:"mona"};return{tree:i,context:m}}const J={}.VITE_GITHUB_PAT;async function X(e){const{repo:n,owner:t,path:o,fileRef:r}=e,l=`https://raw.githubusercontent.com/${t}/${n}/${r||"HEAD"}/${o}`,d=await fetch(l,{});if(d.status!==200)throw new Error("Something bad happened");const f=await d.text(),x={download_url:l,file:o.split("/").pop()||"",path:o,repo:n,owner:t,sha:"HEAD",username:"mona"};return{content:f,context:x}}function Y(e,n){const{repo:t,owner:o,path:r,fileRef:a}=e;return k(["file",e],()=>X({repo:t,owner:o,path:r,fileRef:a}),y(g({},n),{retry:!1,refetchOnWindowFocus:!1}))}function Z(e,n){const{repo:t,owner:o,path:r,fileRef:a}=e;return k(["folder",e],()=>z({repo:t,owner:o,path:r,fileRef:a}),y(g({},n),{retry:!1,refetchOnWindowFocus:!1}))}function ee(){return k("package",()=>K(()=>import("./package.cb0e6a0d.js"),[]),{retry:!1,refetchOnWindowFocus:!1})}const L=e=>{try{const n=window.localStorage.getItem(e);return n?JSON.parse(n):null}catch(n){console.log(n);return}},te=(e,n)=>{const[t,o]=b.exports.useState(L(e)||n);return b.exports.useEffect(()=>{o(L(e)||n)},[e]),[t,a=>{try{o(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(l){console.log(l)}}]},M=()=>s("div",{className:"p-6 text-center bg-red-50 text-red-600 py-20 h-full italic",children:"Something went wrong"}),R=()=>s("div",{className:"p-4",children:s("p",{className:"text-sm",children:"Loading..."})});function ne(e){switch(e){default:return new Promise(function(n,t){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+e)))})}}const B=e=>{const{block:n,contents:t,tree:o,metadata:r={},context:a}=e,[l,d]=b.exports.useState(null),f=async()=>{const i=await A(()=>ne(`../../..${n.entry}`).then(m=>m.Block));d(i)};b.exports.useEffect(()=>{f()},[n.entry]);const x=i=>{window.postMessage({type:"update-metadata",context:a,metadata:i},"*")};return l?s(l,{context:a,content:t,tree:o,metadata:r,onUpdateMetadata:x}):null};function re(e){switch(e){default:return new Promise(function(n,t){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+e)))})}}function oe(e){const{block:n,metadata:t={},dependencies:o,urlParts:r,doMimicProductionEnvironment:a}=e;r.filepathtype==="dir"||!r.owner||!r.name||!r.ref||!r.filepath;const{owner:l,name:d,ref:f,filepath:x}=r,{data:i,status:m}=Y({owner:l,repo:d,path:x,fileRef:f}),u=b.exports.useCallback(async h=>{const c=h.endsWith(".css")?"inline":"raw";return(await re(`../../..${h}?${c}`)).default},[]);return m==="loading"?s(R,{}):m==="error"?s(M,{}):m==="success"&&i?a?s("div",{className:"sandbox-wrapper h-full w-full",children:s(_,{getFileContent:u,contents:i.content,context:y(g({},i.context),{file:d}),dependencies:o,block:n,metadata:t,session:{token:""}})}):s("div",{className:"sandbox-wrapper h-full w-full",children:s(B,{contents:i.content,context:y(g({},i.context),{file:d}),block:n,metadata:t})}):null}function se(e){switch(e){default:return new Promise(function(n,t){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+e)))})}}function le(e){const{block:n,metadata:t={},dependencies:o,urlParts:r,doMimicProductionEnvironment:a}=e;if(r.filepathtype==="blob"||!r.owner||!r.name)return s("div",{className:"p-6 text-center bg-red-50 text-red-600 py-20 h-full italic",children:"Unable to parse this GitHub URL. Are you sure you've linked to a folder and not a file?"});const{owner:l,name:d,ref:f="main",filepath:x="/"}=r,{data:i,status:m}=Z({owner:l,repo:d,path:x,fileRef:f}),u=b.exports.useCallback(async h=>{const c=h.endsWith(".css")?"inline":"raw";return(await se(`../../..${h}?${c}`)).default},[]);return m==="loading"?s(R,{}):m==="error"?s(M,{}):m==="success"&&i?a?s("div",{className:"sandbox-wrapper h-full w-full",children:s(_,{getFileContent:u,tree:i.tree,context:y(g({},i.context),{folder:d}),dependencies:o,block:n,metadata:t,session:{token:""}})}):s("div",{className:"sandbox-wrapper h-full w-full",children:s(B,{tree:i.tree,context:y(g({},i.context),{file:d}),block:n,metadata:t})}):null}function ae({error:e,resetErrorBoundary:n}){return s("div",{className:"p-4",role:"alert",children:s("div",{className:"bg-red-100 border border-red-600 text-sm p-4",children:w("div",{className:"flex items-center justify-between",children:[w("div",{className:"flex-1",children:[s("p",{className:"text-red-600",children:"Something went wrong!"}),s("div",{className:"my-2 overflow-hidden",children:s("p",{className:"overflow-auto text-xs text-red-600 font-mono leading-5",children:e.message})})]}),s("div",{className:"flex-shrink-0",children:s("button",{className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",onClick:n,children:"Try again"})})]})})})}function ce(e){const a=e,{onReset:n,block:t}=a,o=P(a,["onReset","block"]),r=t==null?void 0:t.type;return s(q,{resetKeys:[r],onReset:n,FallbackComponent:ae,children:w($.Fragment,{children:[r==="file"&&s(oe,y(g({},o),{block:t})),r==="folder"&&s(le,y(g({},o),{block:t}))]})})}function ie(){const[e,n]=b.exports.useState("/src/blocks/example-file-block/index.tsx"),[t,o]=b.exports.useState("https://github.com/githubocto/flat/blob/main/src/git.ts"),[r,a]=b.exports.useState(!1),{data:l,status:d}=ee(),f=`composable-github-block-template--${e}-${t}`,[x,i]=te(f,{});b.exports.useEffect(()=>{const c=p=>{var N;if(p.data.codesandbox||p.data.type!=="update-metadata")return;const U=((N=p==null?void 0:p.data)==null?void 0:N.metadata)||{};i(U)};return window.addEventListener("message",c),()=>{window.removeEventListener("message",c)}},[f]);const m=c=>new Promise(p=>{i(c),p()}),u=b.exports.useMemo(()=>{if(!t)return null;try{return D(t)}catch{return null}},[t]),h=l==null?void 0:l.blocks.find(c=>c.entry===e);return w("div",{className:"h-screen flex flex-col overflow-hidden",children:[w("div",{className:"bg-gray-100 border-b p-4 flex-shrink-0 flex items-center",children:[w("div",{className:"w-[400px]",children:[s("label",{className:"text-xs font-medium block mb-1",htmlFor:"url",children:"GitHub File URL"}),s("input",{id:"url",className:"form-input w-full text-sm",placeholder:"Enter GitHub file URL",value:t,onChange:c=>{o(c.target.value)}})]}),w("div",{className:"ml-4",children:[s("label",{className:"text-xs font-medium block mb-1",htmlFor:"block",children:"Block"}),w("select",{onChange:c=>{n(c.target.value)},value:e,disabled:!l||d!=="success",className:"form-select text-sm",name:"block",id:"block",children:[s("option",{disabled:!0,value:"",children:"Select a block"}),s("optgroup",{label:"Folder Blocks",children:l&&l.blocks.filter(c=>c.type==="folder").map((c,p)=>s("option",{value:c.entry,children:c.title},p))}),s("optgroup",{label:"File Blocks",children:l&&l.blocks.filter(c=>c.type==="file").map((c,p)=>s("option",{value:c.entry,children:c.title},p))})]})]}),w("div",{className:"ml-4",children:[s("label",{className:"text-xs font-medium block mb-1",htmlFor:"block",children:"Environment"}),w("select",{onChange:c=>{a(c.target.value==="true")},value:r?"true":"false",className:"form-select text-sm",name:"block",id:"block",children:[s("option",{value:"false",children:"Local dev environment (iterate more quickly)"}),s("option",{value:"true",children:"Production environment (test for bugs in production environment)"})]})]})]}),w("div",{className:"flex-1 overflow-auto",children:[(!e||!t)&&s("div",{className:"p-4",children:s("p",{className:"text-sm",children:"Please select a block and enter a file path."})}),!!h&&!!t&&!!u&&s(ce,{metadata:x,onUpdateMetadata:m,onReset:()=>o(""),block:h,dependencies:l==null?void 0:l.dependencies,urlParts:u,doMimicProductionEnvironment:r},h.entry)]})]})}const de=new j;H.render(s($.StrictMode,{children:s(W,{client:de,children:s(ie,{})})}),document.getElementById("root"));
